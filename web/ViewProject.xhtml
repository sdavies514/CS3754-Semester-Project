<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <ui:composition template="/template/siteTemplate.xhtml">

        <ui:define name="title">
            <h:outputText value="View Project"></h:outputText>
        </ui:define>

        <!-- Create the content for this page below -->
        <ui:define name="editableContent">
            <p:growl id="growl" life="4000" />

            <h:form id="ViewProjectForm" class="ui-datatable-data">
                <div align="center">
                    <h:panelGroup id="display">

                        <p:panelGrid columns="2" columnClasses="columnOne, columnTwo"
                                     rendered="#{projectViewManager.selected != null}">

                            <h:outputText value="#{bundle.ViewProjectLabel_name}"/>
                            <h:outputText value="#{projectViewManager.selected.name}" />

                            <h:outputText value="#{bundle.ViewProjectLabel_rss}"/>

                            <!-- Project RSS Feeds are accessible by providing
                            their RSS key, which is generated once using a
                            cryptographic hash when the project is created. -->
                            <p:link href="webresources/rss?key=#{projectViewManager.selected.rssKey}"
                                    target="_blank" class="dataFields">
                                <!-- Simply link the rss feed to the universal
                                RSS icon. -->
                                <i class="fa fa-rss">&nbsp;</i>
                            </p:link>

                            <h:outputText value="Milestone List" />
                            <p:link href="ListMilestone.xhtml"
                                    target="_blank" class="dataFields">
                                <i class="fa fa-list">&nbsp;</i>
                            </p:link>

                            <h:outputText value="Milestone Calendar" />
                            <p:link href="MilestoneCalendar.xhtml"
                                    target="_blank" class="dataFields">
                                <i class="fa fa-calendar">&nbsp;</i>
                            </p:link>
                        </p:panelGrid>
                    </h:panelGroup>
                    <br /><br />
                </div>
            </h:form>
            <script type="text/javascript">
                function handleMessage(message) {
                    var chatContent = $(PrimeFaces.escapeClientId('form:public')),
                            text = (message.user) ? message.user + ':' + message.text : message.text;

                    chatContent.append(text + '<br />');

                    //keep scroll
                    chatContent.scrollTop(chatContent.height());

                    if (message.updateList) {
                        updateList();
                    }
                }
            </script>
            <div align="center">
            <h:form id="form">
                <!--<p:remoteCommand name="updateList" update="users" process="@this" />-->

                <p:fieldset id="container" legend="Group Chat" toggleable="true"  style="width:550px">

                    <h:panelGroup rendered="#{accountManager.isLoggedIn()}" >
                        <h:panelGrid columns="1" columnClasses="publicColumn,usersColumn">
                            <p:outputPanel style="height:300px; width:500px" id="public" layout="block" styleClass="ui-corner-all ui-widget-content chatlogs" />
                        </h:panelGrid>

                        <p:separator />

                        <p:inputText value="#{chatView.globalMessage}" styleClass="messageInput" />
                        <p:spacer width="5" />
                        <p:commandButton value="Send" actionListener="#{chatView.sendGlobal}" oncomplete="$('.messageInput').val('').focus()" />
                        <p:spacer width="5" />
                        <p:commandButton value="Disconnect" actionListener="#{chatView.disconnect}" global="false" update="container" />
                    </h:panelGroup>

                </p:fieldset>
            </h:form>
            </div>
            <c:if test="#{accountManager.isLoggedIn()}">
                <p:socket onMessage="handleMessage" channel="/#{projectViewManager.selected.name}/#{accountManager.selected.username}"/>
            </c:if>
        </ui:define>
    </ui:composition>

</html>
